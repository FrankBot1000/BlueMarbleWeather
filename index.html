<h1>Blue Marble Weather</h1>
<p>Blue Marble Weather is a tvOS App built using Swift and SwiftUI that integrates Apple’s Apple Weather API and the OpenDataSoft Geoname locations database. You can search for cities/towns (with a population &gt; 1000) to find the current, daily and hourly weather data.</p>
<p>Blue Marble doesn’t link your identity to your current location. It only saves your recently searched locations and provides custom settings for temperature and wind speed unit conversions, as well as custom theme color settings.</p>
<h1>Technologies Used</h1>
<ul>
<li>SwiftUI</li>
<li>Apple Weather</li>
<li>Unit Testing</li>
<li>DocC documentation</li>
<li>Git &amp; GitHub</li>
</ul>
<h1>Animated Weather Data</h1>
<p>…ADD VIDEO HERE (in place of below)…</p>
<!-- https://github.com/SAllen0400/step-readme/assets/10645516/2b4bc7c7-580c-49bf-9d13-38a55be0263c -->
<p><img src="readme-animated-charts.mov" alt="readme-weight-diff" /></p>
<h1>SwiftUI vs UIKit…</h1>
<p>It’s definitely is a big difference working in SwiftUI, as compared to UIKit. Using SwiftUI mechanisms like observable objects, @State and bindings for passing around data and updating views is definitely a lot faster to implement as compared to implementing delegates and building UIKit components, eg. table views.</p>
<p>One of the things I enjoyed learning was how to integrate data from the Apple Weather API in a scrolling horizontal list view showing daily or hourly weather data, and to be present additional weather data below the view while selecting individual list items.</p>
<p>Below is the code for retrieving current, daily and hourly weather:</p>
<pre><code class="language-swift">import Foundation
import WeatherKit
import CoreLocation

/// Includes the 'service' WeatherKit WeatherSearch.shared object.
///
/// Will primarily use the 'shared' static let property to access WeatherData methods.
class WeatherData: ObservableObject {
    static let shared   = WeatherData()
    private let service = WeatherService.shared
    
    func currentHourlyDailyForecast(for location: CLLocation) async -&gt; (CurrentWeather, Forecast&lt;HourWeather&gt;, Forecast&lt;DayWeather&gt;)? {
        let currentDailyHourlyForcast = await Task.detached(priority: .userInitiated) {
            let forcast = try? await self.service.weather(
                for: location,
                including: .current, .hourly, .daily)
            return forcast
        }.value
        return currentDailyHourlyForcast
    }
}
</code></pre>
<br>
</br>
<p>The daily/hourly scrolling view, called from the main view:</p>
<pre><code class="language-swift">switch forecastSelection {
                case .currently:
                    CurrentlyView(currentWeather: currentWeather)
                case .daily:
                    HScrollViewForecast(weather: $dailyWeather, selectedItem: $selectedItem)
                        .onChange(of: selectedItem) { oldValue, newValue in
                            if let dailyWeather = dailyWeather, let selectedItem = selectedItem, (0..&lt;dailyWeather.count).contains(selectedItem) {
                                selectedDayWeather = dailyWeather[selectedItem]
                            }
                            
                        }
                case .hourly:
                    HScrollViewForecast(weather: $hourlyWeather,
                                        selectedItem: $selectedItem)
                    .onChange(of: selectedItem) { oldValue, newValue in
                        if let hourlyWeather = hourlyWeather, let selectedItem = selectedItem, (0..&lt;hourlyWeather.count).contains(selectedItem) {
                            selectedHourWeather = hourlyWeather[selectedItem]
                        }
                    }
                }
</code></pre>
<br>
</br>
<p>Code for the HScrollViewForecast:</p>
<pre><code class="language-swift">/// The horizontal scroll view that presents the hourly or daily forcast.
/// - Note: Both Forecast&lt;HourWeather&gt; and Forecast&lt;DayWeather&gt; conform to the RandomAccessCollection Protocol.
struct HScrollViewForecast&lt;T: RandomAccessCollection&gt;: View {
    @Binding var weather: T?
    
    @FocusState.Binding var selectedItem: Int?
    
    var body: some View {
        HStack {
            ScrollView(.horizontal) {
                HStack(spacing: 20) {
                    switch weather {
                    case is Forecast&lt;HourWeather&gt;:
                        if let weather = weather {
                            ForEach(Array(weather.enumerated()), id: \.offset) { index, weather in
                                HourlyView(hourWeather: weather as? HourWeather,
                                          selectedItem: $selectedItem,
                                          index: index)
                            }
                            .padding()
                        }
                    // By default, show DayWeather:
                    default:
                        if let forecast = weather {
                            ForEach(Array(forecast.enumerated()), id: \.offset) { index, weather in
                                DailyView(dayWeather: weather as? DayWeather,
                                          selectedItem: $selectedItem,
                                          index: index)
                            }
                            .padding()
                        }
                    }
                }
            }
            .frame(width: 1000)
        }
    }
}
</code></pre>
<br>
</br>
<p>Code for loading weather data from the main view:</p>
<pre><code class="language-swift">.task {
                isLoadingData = true
                
                ...
                
                // Gets Initial GeoLocation Weather Data:
                Task.detached {
                    if let geoLocation = await geoFavoritesVM.geoLocationFrom(favorite: favoriteLocation) {
                        await getWeatherData(for: geoLocation.cllLocation)
                    }
                }
                
				...
            }
            
            ...
            
            func getWeatherData(for location: CLLocation) async {
        Task.detached {
            if let (current, hourly, daily) = await weatherServiceHelper.currentHourlyDailyForecast(for: location) {
                let weatherAttribution      = await weatherServiceHelper.weatherAttribution()
                
                await MainActor.run {
                    attribution             = weatherAttribution
                    isLoadingData           = false
                    self.currentWeather     = current
                    self.dailyWeather       = daily
                    self.hourlyWeather      = hourly
                }
            }
        }
    }
</code></pre>
<br>
</br>
<p>…ADD NEW IMAGES HERE (in place of below)</p>
<!-- ![readme-weight-diff](https://github.com/SAllen0400/step-readme/assets/10645516/afdef8cb-9e40-4fac-9548-87dbb708a35c) -->
<p><img src="readme-weight-diff.png" alt="readme-weight-diff" /></p>
<h1>Completeness</h1>
<p>Although it’s a simple portfolio project, I’ve implemented the following</p>
<ul>
<li>Unit Testing</li>
<li>Code documentation, DocC</li>
<li>Error handling</li>
<li>Alerts</li>
<li>Empty states</li>
<li>Text input validation</li>
<li>Project organization</li>
</ul>
